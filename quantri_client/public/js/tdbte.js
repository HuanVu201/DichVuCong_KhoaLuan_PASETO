/**
* bte 2017-12-29
* @version 1.1.0-alpha1 
* @author N.K.Chinh
* @copyright (C) Tandan JSC
*/
var TD=TD||{};TD.utils=TD.utils||{},function(a){a.utils.downloadFile=a.utils.downloadFile||function(a,b,c){var d=new XMLHttpRequest;d.open("GET",a),d.responseType="arraybuffer",d.onload=function(){if(200===this.status){var a=new Uint8Array(this.response);c(!0,a)}else c(!1)},d.send()};var b=function(){this.watchingEvent=d.close,this.onmessage=null,this.ondatareceived=null,this.onopen=null,this.onclose=null,this.onstatus=null,this._fireOnMessageEvent=function(a,b){this.onmessage&&this.onmessage(a,b)},this._fireOnDataReceivedEvent=function(a){this.ondatareceived&&this.ondatareceived(a)},this._fireOnStatus=function(a){this.onstatus&&this.onstatus(a)},this._blobToArray=function(a,b){var c,d=new FileReader;d.addEventListener("loadend",function(){c=this.result;var a=new Uint8Array(c);b(a)}),d.readAsArrayBuffer(a)}};b.prototype={connect:function(b,c){function d(a){"1"==a.data?q.onmessage=i:o._fireOnStatus(h.protocolNotSupported)}function i(a){a.data==e.ACCEPT?(q.onmessage=j,q.send(c)):o._fireOnStatus(h.invalidFileName)}function j(a){a.data==f.OPENED?q.onmessage=k:o._fireOnStatus(h.canceled)}function k(a){o._blobToArray(a.data,function(a){var b=a[0];if((b&o.watchingEvent)==b){var c=new Array;o._fireOnMessageEvent(b,{getData:function(){c.indexOf(g.GETDATA)==-1&&c.push(g.GETDATA)},closeConnection:function(){c.indexOf(g.CLOSE_CNN)==-1&&c.push(g.CLOSE_CNN)},quitApp:function(){c.indexOf(g.QUIT_APP)==-1&&c.push(g.QUIT_APP)}}),(0==c.length||c.length>0&&c[c.length-1]!=g.CLOSE_CNN)&&c.push(g.NONE),o._usr_req=c,l()}})}function l(){if(!o._usr_req||0==o._usr_req.length)return void(q.onmessage=k);var a=o._usr_req[0];o._usr_req.splice(0,1),a==g.GETDATA?q.onmessage=m:q.onmessage=k,q.send(a),a!=g.GETDATA&&l()}function m(a){a.data==e.ACCEPT?q.onmessage=n:l()}function n(a){o._fireOnDataReceivedEvent(a.data),l()}var o=this,p=!1,q=new WebSocket("ws://127.0.0.1:58201","openfile");q.onerror=function(){p||o._fireOnStatus(h.connectionError)},q.onmessage=d,q.onopen=function(){p=!0;var c=new Uint8Array(1);c[0]=o.watchingEvent||a.bte.eventCodes.close,q.send(c),q.send(b),o.onopen&&o.onopen()},q.onclose=function(){o.onclose&&o.onclose()}},scan:function(a){a=a||{};var b=this.scanner();b.opt.settingsFunc=a.scanSettingsFunc,b.opt.appInfo=a.appInfo,b.scan()},scanner:function(){var a=this;if(this.$scanner)return this.$scanner;var b=new c({success:function(b){a.scanFinished&&a.scanFinished(!0,b)},error:function(){a.scanFinished&&a.scanFinished(!1)}});return this.$scanner=b,b}};var c=function(a){this.$opt=a||{}};c.prototype={scan:function(){var a=this,b=new WebSocket("ws://127.0.0.1:58201","scan"),c=!1,d=function(c){b.onmessage=function(b){b.data&&0!=b.data.size?a.$opt.success&&a.$opt.success.call(a,b.data):a.$opt.error&&a.$opt.error.call(a)},b.send(JSON.stringify(c||{}))};b.onmessage=function(c){"1"==c.data?(b.onmessage=function(b){var c;try{c=JSON.parse(b.data)}catch(a){c={}}a.$opt.settingsFunc?a.$opt.settingsFunc(c,function(a,b){d(a?newSt:c)}):d(c)},b.send(JSON.stringify(a.$opt.appInfo||{}))):a.$opt.error&&a.$opt.error.call(a)},b.onopen=function(){c=!0},b.onerror=function(){c?a.$opt.error&&a.$opt.error.call(a):"function"==typeof a.$opt.connectionError&&a.$opt.connectionError.call(a)}},done:function(a){return this.$opt.success=a,this},fail:function(a){return this.$opt.error=a,this},connectionError:function(a){return this.$opt.connectionError=a,this}};var d={none:0,change:1,open:2,close:4,del:8},e={ACCEPT:"A",IGNORE:"I"},f={OPENED:"O",FAILED:"F"},g={NONE:"N",GETDATA:"G",CLOSE_CNN:"C",QUIT_APP:"Q"},h={connectionError:1,canceled:2,invalidFileName:3,protocolNotSupported:4};a.bte=b,a.Bte=b,a.bte.eventCodes=d,a.bte.res=e,a.bte.FileOpenStatus=f,a.bte.rqCode=g,a.bte.status=h}(TD);
//# sourceMappingURL=td.bte.min.js.map